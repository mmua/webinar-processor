import pytest
from webinar_processor.utils.openai import split_text_to_sentences


def test_split_text_to_sentences():
    text = ("Это первый пример. "
            "Вот второй пример, который длиннее и содержит больше слов. "
            "А вот и третий пример.")

    expected_output = [
        "Это первый пример.",
        "Вот второй пример, который длиннее и содержит больше слов.",
        "А вот и третий пример."
    ]

    result = split_text_to_sentences(text)

    assert result == expected_output, f"Expected {expected_output}, but got {result}"


def test_split_text_to_sentences_long_text():
    text = ("control или shift command на маке shift command и стрелочку вниз shift command вниз видите у меня "
            "выделился только один столбец но весь первый столбец но весь а поскольку у меня теперь выделение на всем "
            "столбце присутствует я нажимаю также зажав shift control или shift command нажимая клавишу вправо и у меня "
            "выделились теперь все данные еще раз еще раз коллеги вы со мной артем микрофон микрофон напоминаю еще раз "
            "shift control или shift command ячейка стрелка вниз стрелка вправо и вы выделяете все данные вашего вашей "
            "таблице так у меня чё-то слетело и lookup открыть lookup value точка запятой переходим на страницу data set "
            "пам пам пам пам это для чего горячие клавиши это у нас сейчас здесь 108 строк это нормально жить можно там и "
            "мышкой можно выделить а что если там 117 тысяч штук и вы будете сидеть ждать тянуть вниз нет конечно вот "
            "коллеги нужно нам здесь закрепить диапазон и 2d 108 да по-любому комбинация клавиш контроль т закрепляем и по "
            "столбцу и по строке и по столбцу и по строке отбиваем не забудьте пожалуйста отбить коллеги посмотрите "
            "пожалуйста внимательно на мою команду на адресную строку вы видите здесь рядом с диапазоном появилось название "
            "листа что она обозначает это говорит о том что диапазон а2 g 108 у нас на листе data set находится это "
            "понятненько нигде-то там не на листе вилу кап анализ те дейта сет находится у вас ведь также на русской "
            "раскладке или там на windows да также да конечно отбиваемся опять здесь же точкой запятой и у нас находится "
            "индекс вхождения поля какой нам индекс вхождения поля нужен какой вот этот кал 5 раз 2 3 4 5 до канал продаж "
            "у нас 5 5 столбец имеем отбиваемся опять точкой запятой и нам нужен exact match exact match и выясняется что у "
            "айди дистрибьютора 23265 канал продаж ритейл ну-ка давайте к самим себя на вшивость проверим control f 23265 "
            "где он канал продаж ритейл ай да мы ай да мы а еще сейчас мы спустимся вот так вот и увидим что у нас канал "
            "продаж ритейл онлайн или прямой коллеги получилось сделать слушаю вас получилось вопрос вот мы формули пишем "
            "номер столбца у нас в этом случае 5 а что если 1000 столбцов и столбец 783 или это далее вы скажете прикиньте "
            "как бесит я я понимаю поэтому для меня индекс мэдж индекс мэдж но ну вот как-то приходится этим жить не знаю "
            "но есть функции которые узнают номер столбца вот есть функции которые узнают номер столбца это действительно "
            "это действительно прямая тупая же функции согласитесь вот до до этих вещей что но считать надо ну лень же "
            "правильно лень вот но при простом вот таком сопоставлении велу кап очень очень помогает коллеги не дадут соврать "
            "коллеги пользовались когда-нибудь в паэром гпэром кто не говорил что он пользовался но я не думаю что это будет "
            "там серьезной проблемой вот коллеги те кто не до конца ранее изучал excel и для кого это первый опыт есть "
            "понимание того что тут происходит все ли получается да пока все получается есть те у кого не получается и нужны "
            "вопросы подскажите пожалуйста почему мы ставим тут false по давайте супер отличный вопрос убираю false и "
            "посмотрите пожалуйста какие опции он мне предлагает он будет искать сопоставление этому айди дистрибьютору "
            "каким образом вот он говорит как мне искать примерно примерно или точно мы как хотим айди дистрибьютора чтобы "
            "он нашел 23265 точно или примерно но тут мы выбрали примерно")
    
    # We expect the function to handle this gracefully and return some split segments
    result = split_text_to_sentences(text)
    
    # Check that the result is a list and has multiple segments
    assert isinstance(result, list), "The result should be a list"
    assert len(result) > 1, "The result should contain multiple segments"
    assert all(isinstance(segment, str) for segment in result), "All segments should be strings"


if __name__ == "__main__":
    pytest.main()
